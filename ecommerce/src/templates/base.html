<!doctype html><html lang="en">  <head>    <!-- Required meta tags -->    <meta charset="utf-8">    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">    <!-- Bootstrap CSS -->    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">    <link rel="stylesheet" href="/static/css/main.css" >        <title>{% block title %}{% endblock %}</title>  </head>    <body class="col-12 col-md-12 mx-auto">      {% block content %}{% endblock %}               <!-- Optional JavaScript -->    <!-- jQuery first, then Popper.js, then Bootstrap JS -->    <!-- slim is missing ajax -->        {% block script %}    <script src="https://code.jquery.com/jquery-3.5.1.min.js" ></script>    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>    {% endblock %}        <!-- jquery-->   <script src="https://code.jquery.com/jquery-3.5.1.min.js" ></script>{% verbatim %}<script id="stripeCardFormTemplate" type="text/x-jsrender">            <form class="payment-form" action="/charge" method="POST" id="payment-form" data-token="{{:data_token}}" data-next-url="{{:data_next_url}}">              <div class="form-row">                <div id="card-element" class="form-control">                  <!-- A Stripe Element will be inserted here. -->                </div>                            <!-- Used to display form errors. -->                <div id="card-errors" role="alert"></div>              </div>                          <button class="btn btn-success my-3">Add Card</button>        </form></script>{% endverbatim %}    <!-- js render--><script src="https://www.jsviews.com/download/jsrender.js"></script>            <!-- get csrf token from cookies -->    <script>        $(document).ready(function(){                    function getCookie(name){                var cookieValue = null;                if(document.cookie && document.cookie!==" "){                    var cookies = document.cookie.split(";");                                        for (var i=0;i<cookies.length;i++){                        var cookie =jQuery.trim(cookies[i])                        console.log(cookie)                                                if(cookie.substring(0,name.length+1)===(name+"=")){                            cookieValue = decodeURIComponent(cookie.substring(name.length+1));                            break;                        }                                        }                                }                                return cookieValue;                                    }                var csrftoken = getCookie("csrftoken");                function csrfSafeMethod(method){            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));        }                $.ajaxSetup({            beforeSend:function(xhr,settings){                if(!csrfSafeMethod(settings.type) && !this.crossDomain){                    xhr.setRequestHeader("X-CSRFToken",csrftoken)                                }                        }        });            })    </script>        <script src="https://js.stripe.com/v3/"></script><script> $(document).ready(function (){     <!-- You may test your Stripe.js integration over HTTP. However, live Stripe.js integrations must use HTTPS. -->    var stripeCardFormModuel = $(".reusable_stripe_payment_form")    var stripeToken = stripeCardFormModuel.attr("data_token")    var next_url = stripeCardFormModuel.attr("next_url")    console.log(next_url)            var stripeCardFormTemplate = $.templates("#stripeCardFormTemplate")    var stripeCardFormTemplateDataContext = {        data_token: stripeToken,        data_next_url: next_url        }    var stripeCardFormTemplateHtml = stripeCardFormTemplate.render(stripeCardFormTemplateDataContext)        stripeCardFormModuel.html(stripeCardFormTemplateHtml)          // Create a Stripe client.    var stripe = Stripe("pk_test_51HRwMeEcligTwCtGrB70qW1aPm94C4P6f8U3Mdo8CJ1mYFRJau5OH0zeFGq3CXmeGYZ7taXrRKTJwCQGcR5krfpL00jlRIytcR");    // Create an instance of Elements.    var elements = stripe.elements();        // Custom styling can be passed to options when creating an Element.    // (Note that this demo uses a wider set of styles than the guide below.)    var style = {      base: {        color: '#32325d',        fontFamily: '"Helvetica Neue", Helvetica, sans-serif',        fontSmoothing: 'antialiased',        fontSize: '16px',        '::placeholder': {          color: '#aab7c4'        }      },      invalid: {        color: '#fa755a',        iconColor: '#fa755a'      }    };        // Create an instance of the card Element.    var card = elements.create("card", {style: style});        // Add an instance of the card Element into the `card-element`.    card.mount("#card-element");        // Handle form submission.    var form = document.getElementById("payment-form");    var nextURL = $(form).attr("data-next-url");        console.log("next url: "+nextURL)        form.addEventListener("submit", function(event) {      event.preventDefault();          stripe.createToken(card).then(function(result) {        if (result.error) {              // Inform the user if there was an error.              var errorElement = document.getElementById("card-errors");              errorElement.textContent = result.error.message;        } else {              // Send the token to your server.              stripeTokenHandler(nextURL,result.token);              console.log(result.token);        }      });    });    // Submit the form with the token ID.    function stripeTokenHandler(nextURL,token) {        var paymentMethodEndpoint = "/billing/paymentmethod/create/";        var data = {"token":token.id};        $.ajax({            data:data,            url:paymentMethodEndpoint,            method:"POST",            success:function(data){                console.log(data);                card.clear();                                if (nextURL){                    successMsg = "Card added successfully! Redirecting......"                    alert(successMsg)                    setTimeout(function(){                        window.location.href=nextURL                    },300)                } else{                    errorMsg = "Card was not added, try again"                    alert(errorMsg)                }                                                                },            error:function(error){                console.log(error)            }        })                              } }) </script>      <style>        .StripeElement {          box-sizing: border-box;                  height: 40px;                  padding: 10px 12px;                  border: 1px solid transparent;          border-radius: 4px;          background-color: white;                  box-shadow: 0 1px 3px 0 #e6ebf1;          -webkit-transition: box-shadow 150ms ease;          transition: box-shadow 150ms ease;    }            .StripeElement--focus {          box-shadow: 0 1px 3px 0 #cfd7df;        }                .StripeElement--invalid {          border-color: #fa755a;        }                .StripeElement--webkit-autofill {          background-color: #fefde5 !important;          }    </style>      </body></html>